From f4f760140ea5a5760c88203ac19176c600e4cfea Mon Sep 17 00:00:00 2001
From: "yi.zhang1" <yi.zhang1@amlogic.com>
Date: Fri, 28 Apr 2023 17:21:48 +0800
Subject: [PATCH] amlbian: gstreamer-build modify  [1/1]

PD#SWPL-114580

Problem:
if gstreamer cache is empty,build will error.

Solution:
add new function.

Verify:
local

Signed-off-by: yi.zhang1 <yi.zhang1@amlogic.com>
Change-Id: I433a85aa3245d894bec8e56948b8c6e645739b7a
---
 config/functions/build-gstreamer | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/config/functions/build-gstreamer b/config/functions/build-gstreamer
index 254a415..45b3c0d 100755
--- a/config/functions/build-gstreamer
+++ b/config/functions/build-gstreamer
@@ -13,7 +13,6 @@ build_gstreamer() {
 		eval "cp -rf "$PKG_BUILD_CACHE"/$GSTPKGNAME/ $GSTREAMER_VENDOR_DIR"
 	fi
 
-    
     if [ -f "$GSTREAMER_COMPILE_DIR"/.cachefile ]
     then
         echo "gstreamer cache file already exist,needn't copy"
@@ -116,7 +115,7 @@ build_gstreamer() {
           #echo "$file_after_install add to installed_files"
           echo "cp -rf $gst_file_after_install $PKG_BUILD_CACHE/gstreamer_cache"
           cp -rf $GSTREAMER_COMPILE_DIR/subprojects/$gst_file_after_install $PKG_BUILD_CACHE/gstreamer_cache
-          touch .cachesuccess
+          touch "$PKG_BUILD_CACHE"/gstreamer_cache/.cachesuccess
       else
           flag=0
       fi
@@ -170,7 +169,7 @@ build_gstreamer_deb() {
     cp -arf $GST_BUILD_DIR/subprojects/gst-plugins-good/sys/v4l2/*.so $gst_lib_install_dir
     mkdir -p $gst_yocto_lib_install_dir
     cp -arf $GST_BUILD_DIR/subprojects/gstreamer/gst/libgstreamer-1.0.so.0.2003.0 $gst_yocto_lib_install_dir
-     
+
     #start make debs
     mkdir -p $pkgdir/DEBIAN
 
@@ -209,7 +208,7 @@ install_gstreamer_deb() {
         rm -rf $ROOTFS_TEMP/usr/lib/aarch64-linux-gnu/gstreamer-1.0/libgstvideo4linux2.so
     fi
 
-    rm -rf $ROOTFS_TEMP/usr/lib/aarch64-linux-gnu/libgstreamer-1.0.so.0.2003.0 
+    rm -rf $ROOTFS_TEMP/usr/lib/aarch64-linux-gnu/libgstreamer-1.0.so.0.2003.0
 
     info_msg "install gstreamer debs start: $GST_GOOD_DEB"
     install_gst_deb_chroot $BUILD_DEBS/$VERSION/$WORK_BOARD/${DISTRIBUTION}-${DISTRIB_RELEASE}/${GST_GOOD_DEB}_${VERSION}_${DISTRIB_ARCH}.deb
-- 
2.25.1

